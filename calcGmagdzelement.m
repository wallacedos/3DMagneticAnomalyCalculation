function Gelement = calcGmagdzelement(coeff,ulbound)
%  Summary of this function goes here.
%  it's the key function of calculating the total magnetic field anomaly  
%  with respect to the derivative of z.
%  More details about the formula you can find from the follwing
%  references.
%
%  References: 
%  郭志宏,管志宁,熊盛青.长方体ΔT场及其梯度场无解析奇点理论表达式
%  [J].地球物理学报,2004(06):1131-1138.
%
%  Author(s): Yan Yingwei
%  Copyright: 2019-2022 
%  Revision: 1.0  Date: 3/16/2019
%
%  Department of Geophysics, Jilin University.

k1=coeff(1);k2=coeff(2);k3=coeff(3);k4=coeff(4);k5=coeff(5);k6=coeff(6);
x1=ulbound(1);x2=ulbound(2);y1=ulbound(3);y2=ulbound(4);z1=ulbound(5);z2=ulbound(6);

r1=(x1^2 + y1^2 + z1^2)^(1/2);
r2=(x2^2 + y1^2 + z1^2)^(1/2);
r3=(x1^2 + y2^2 + z1^2)^(1/2);
r4=(x2^2 + y2^2 + z1^2)^(1/2);
r5=(x1^2 + y1^2 + z2^2)^(1/2);
r6=(x2^2 + y1^2 + z2^2)^(1/2);
r7=(x1^2 + y2^2 + z2^2)^(1/2);
r8=(x2^2 + y2^2 + z2^2)^(1/2);

c1=k1*z1;c2=k1*z2;
c3=k2*z1;c4=k2*z2;
c5=x1*y2;c6=x1*y1;
c7=x2*y1;c8=x2*y2;

% d1=y1^2 + z1^2; d2=y2^2 + z1^2;
% d3=y1^2 + z2^2; d4=y2^2 + z2^2;

% Gelement1=(c1)/((x1 + r1)*r1) - (c1)/((x1 + r3)*r3) -...
%     (c1)/((x2 + r2)*r2) - (c2)/((x1 + r5)*r5) + ...
%     (c1)/((x2 + r4)*r4) + (c2)/((x1 + r7)*r7) + ...
%     (c2)/((x2 + r6)*r6) - (c2)/((x2 + r8)*r8);

Gelement1=c1/((x1 + r1)*r1) -  c1/((x2 + r2)*r2) -...
          c1/((x1 + r3)*r3)+c1/((x2 + r4)*r4) - ...
          c2/((x1 + r5)*r5) + c2/((x2 + r6)*r6) + ...
          c2/((x1 + r7)*r7) - c2/((x2 + r8)*r8);

% Gelement2=(c3)/((y1 + r1)*r1) - (c3)/((y1 + r2)*r2) - ...
%     (c3)/((y2 + r3)*r3) - (c4)/((y1 + r5)*r5) +...
%     (c3)/((y2 + r4)*r4) + (c4)/((y1 + r6)*r6) + ...
%     (c4)/((y2 + r7)*r7) - (c4)/((y2 + r8)*r8);


Gelement2=c3/((y1 + r1)*r1) - c3/((y1 + r2)*r2) - ...
          c3/((y2 + r3)*r3) + c3/((y2 + r4)*r4) -...
          c4/((y1 + r5)*r5) + c4/((y1 + r6)*r6) + ...
          c4/((y2 + r7)*r7) - c4/((y2 + r8)*r8);
      
% Gelement3=(k3*(z1/r1 + 1))/(z1 + r1) - (k3*(z1/r3 + 1))/(z1 + r3) - ...
%     (k3*(z1/r2 + 1))/(z1 + r2) + (k3*(z1/r4 + 1))/(z1 + r4) - ...
%     (k3*(z2/r5 + 1))/(z2 + r5) + (k3*(z2/r7 + 1))/(z2 + r7) + ...
%     (k3*(z2/r6 + 1))/(z2 + r6) - (k3*(z2/r8 + 1))/(z2 + r8);
  
Gelement3=k3*((z1/r1 + 1)/(z1 + r1) - (z1/r3 + 1)/(z1 + r3) - ...
         (z1/r2 + 1)/(z1 + r2) + (z1/r4 + 1)/(z1 + r4) - ...
         (z2/r5 + 1)/(z2 + r5) + (z2/r7 + 1)/(z2 + r7) + ...
         (z2/r6 + 1)/(z2 + r6) - (z2/r8 + 1)/(z2 + r8));
  
Gelement4=k4*((c5*(2*z1 + r3 + z1^2/r3))/(((x1^2*y2^2)/(z1*r3 + x1^2 + z1^2)^2 + 1)*(z1*r3 + x1^2 + z1^2)^2) -...
          (c6*(2*z1 + r1 + z1^2/r1))/(((x1^2*y1^2)/(z1*r1 + x1^2 + z1^2)^2 + 1)*(z1*r1 + x1^2 + z1^2)^2) + ...
          (c7*(2*z1 + r2 + z1^2/r2))/(((x2^2*y1^2)/(z1*r2 + x2^2 + z1^2)^2 + 1)*(z1*r2 + x2^2 + z1^2)^2) + ...
          (c6*(2*z2 + r5 + z2^2/r5))/(((x1^2*y1^2)/(z2*r5 + x1^2 + z2^2)^2 + 1)*(z2*r5 + x1^2 + z2^2)^2) - ...
          (c8*(2*z1 + r4 + z1^2/r4))/(((x2^2*y2^2)/(z1*r4 + x2^2 + z1^2)^2 + 1)*(z1*r4 + x2^2 + z1^2)^2) - ...
          (c5*(2*z2 + r7 + z2^2/r7))/(((x1^2*y2^2)/(z2*r7 + x1^2 + z2^2)^2 + 1)*(z2*r7 + x1^2 + z2^2)^2) - ...
          (c7*(2*z2 + r6 + z2^2/r6))/(((x2^2*y1^2)/(z2*r6 + x2^2 + z2^2)^2 + 1)*(z2*r6 + x2^2 + z2^2)^2) + ...
          (c8*(2*z2 + r8 + z2^2/r8))/(((x2^2*y2^2)/(z2*r8 + x2^2 + z2^2)^2 + 1)*(z2*r8 + x2^2 + z2^2)^2));
 
Gelement5=k5*((c7*(2*z1 + r2 + z1^2/r2))/(((x2^2*y1^2)/(z1*r2 + y1^2 + z1^2)^2 + 1)*(z1*r2 + y1^2 + z1^2)^2) -...
          (c6*(2*z1 + r1 + z1^2/r1))/(((x1^2*y1^2)/(z1*r1 + y1^2 + z1^2)^2 + 1)*(z1*r1 + y1^2 + z1^2)^2) + ...
          (c5*(2*z1 + r3 + z1^2/r3))/(((x1^2*y2^2)/(z1*r3 + y2^2 + z1^2)^2 + 1)*(z1*r3 + y2^2 + z1^2)^2) + ...
          (c6*(2*z2 + r5 + z2^2/r5))/(((x1^2*y1^2)/(z2*r5 + y1^2 + z2^2)^2 + 1)*(z2*r5 + y1^2 + z2^2)^2) - ...
          (c8*(2*z1 + r4 + z1^2/r4))/(((x2^2*y2^2)/(z1*r4 + y2^2 + z1^2)^2 + 1)*(z1*r4 + y2^2 + z1^2)^2) - ...
          (c7*(2*z2 + r6 + z2^2/r6))/(((x2^2*y1^2)/(z2*r6 + y1^2 + z2^2)^2 + 1)*(z2*r6 + y1^2 + z2^2)^2) - ...
          (c5*(2*z2 + r7 + z2^2/r7))/(((x1^2*y2^2)/(z2*r7 + y2^2 + z2^2)^2 + 1)*(z2*r7 + y2^2 + z2^2)^2) + ...
          (c8*(2*z2 + r8 + z2^2/r8))/(((x2^2*y2^2)/(z2*r8 + y2^2 + z2^2)^2 + 1)*(z2*r8 + y2^2 + z2^2)^2));
 
Gelement6=k6*((((c6)/(x1^2 + y1^2 + z2^2)^(3/2) + (c6)/(z2^2*r5)))/((x1^2*y1^2)/(z2^2*(x1^2 + y1^2 + z2^2)) + 1) -...
          (((c6)/(x1^2 + y1^2 + z1^2)^(3/2) + (c6)/(z1^2*r1)))/((x1^2*y1^2)/(z1^2*(x1^2 + y1^2 + z1^2)) + 1) + ...
          (((c5)/(x1^2 + y2^2 + z1^2)^(3/2) + (c5)/(z1^2*r3)))/((x1^2*y2^2)/(z1^2*(x1^2 + y2^2 + z1^2)) + 1) + ...
          (((c7)/(x2^2 + y1^2 + z1^2)^(3/2) + (c7)/(z1^2*r2)))/((x2^2*y1^2)/(z1^2*(x2^2 + y1^2 + z1^2)) + 1) - ...
          (((c5)/(x1^2 + y2^2 + z2^2)^(3/2) + (c5)/(z2^2*r7)))/((x1^2*y2^2)/(z2^2*(x1^2 + y2^2 + z2^2)) + 1) - ...
          (((c7)/(x2^2 + y1^2 + z2^2)^(3/2) + (c7)/(z2^2*r6)))/((x2^2*y1^2)/(z2^2*(x2^2 + y1^2 + z2^2)) + 1) - ...
          (((c8)/(x2^2 + y2^2 + z1^2)^(3/2) + (c8)/(z1^2*r4)))/((x2^2*y2^2)/(z1^2*(x2^2 + y2^2 + z1^2)) + 1) + ...
          (((c8)/(x2^2 + y2^2 + z2^2)^(3/2) + (c8)/(z2^2*r8)))/((x2^2*y2^2)/(z2^2*(x2^2 + y2^2 + z2^2)) + 1));
      
Gelement=Gelement1+Gelement2+Gelement3+Gelement4+Gelement5+Gelement6;
end

